<!DOCTYPE html>
<html lang="">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">

    <!-- commented for dromdown menu hover bug -->
    <!-- <link href="../../static/library/bootstrap-theme.min-3.3.6.css" rel="stylesheet"> -->

    <script src="../../static/js/jquery_351/jquery.min.js"></script>
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">

    <link rel="stylesheet" type="text/css" href="../../static/library/tom-select-2.2.1.css">
    <script src="../../static/library/tom-select.complete-2.2.1.min.js"></script>
    <script type="text/javascript" src="../../static/js/searchable-select.js"></script>

    <!-- anychart modules -->
    <script src="../../static/library/anychart-8.10.0-core.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-graph.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-pie.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-exports.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-cartesian.min.js"></script>

    <!-- Footable  -->
    <script src="../../static/js/footable/demo-rows.js"></script>
    <script src="../../static/js/footable/ie10-viewport-bug-workaround.js"></script>
    <script src="../../static/js/footable/footable.js"></script>
    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">
    <link href="../../static/styles/footable/docs.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.Glyphicons.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.FontAwesome.css" rel="stylesheet">

    <link rel="stylesheet" href="../../static/styles/index2.css">
    <link rel="stylesheet" href="../../static/styles/search_chart.css">

    <link rel="stylesheet" type="text/css" href="../../static/library/jquerysctipttop.css">

    <!-- Intro Js -->
    <script src="../../static/library/intro.min-4.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs-rtl.min-4.3.0.css">
    <link rel="stylesheet" href="../../static/styles/user_guide_tour.css">
    <meta charset="UTF-8">


    <!-- Notyf  -->
    <link rel="stylesheet" type="text/css" href="../../static/library/notyf.min-npm.css">
    <script src="../../static/library/notyf.min.js"></script>

    <!--<script type="text/javascript" src="http://l2.io/ip.js?var=myip">
    </script>-->

    <title> انطباق ادبیات حقوقی</title>
    {% include "doc/title_icon.html" %}
</head>

<body>
    <!-- Menu -->
    <nav dir="rtl" class="navbar nav_menu navbar-expand-lg fixed-top p-0 mt-0">
        {% include "doc/header2.html" %}
    </nav>

    <script>
        $(document).ready(function () {

            // Active panel
            $('#SepecificDropdown').addClass('active');
            $('#legal_literature_adaptation').addClass('active');


            $('select#language').on('change', function (e) {

                let selected_language = this.value;
                let current_url = window.location.href;
                if (selected_language === 'England') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'en')
                    window.location = requested_url;
                } else if (selected_language === 'Russia') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'ru')
                    window.location = requested_url;
                }

            });
        });
    </script>

    <!-- Main Container includes: Form Fields, Tab Pills, Tab Panes -->
    <div class="row flex-row-reverse px-0 py-5 px-md-5 py-md-5 m-0">

        <!-- Form Fields -->
        <form action="" class="custom-control mx-auto needs-validation" id="info_form" enctype="multipart/form-data"
            method="post" novalidate>

            <!-- Primary Fields in First Row -->
            <div class="row flex-row-reverse mx-auto">

                <!-- Country Input -->
                <div class="col-md-6 pt-3 col-12 col-lg-2 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;">مجموعه سند:</label>
                    <select dir="rtl" id="country" name="country" class="form-select text-right float-right searchable-select"
                        style="direction: rtl;" onchange="CountryChanged()">
                        {% for k,v in countries.items %}
                        <option value="{{ k }}">{{ v }}</option>
                        {% endfor %}
                    </select>

                </div>


                <!-- Search Box inputs -->
                <div class="col-md-6 pt-3 col-12 col-lg-3 bg-light">
                    <label class="float-right" style="direction: rtl;">عبارت اول <span style="color: red">(*)</span>:</label>
                    <input style="direction: rtl;" class="float-left form-control text-right"
                        placeholder="متن جست‌وجو ..." type="text" required="" name="SearchBox1" id="SearchBox1" value="">
                </div>
                <div class="col-md-6 pt-3 col-12 col-lg-3 bg-light">
                    <label class="float-right" style="direction: rtl;">عبارت دوم <span style="color: red">(*)</span>:</label>
                    <input style="direction: rtl;" class="float-left form-control text-right"
                        placeholder="متن جست‌وجو ..." type="text" required="" name="SearchBox2" id="SearchBox2" value="">
                </div>

                <!--  Buttons -->
                <div class="col-lg-3 col-md-6 pt-5 col-12">
                    <button type="button" id="document_search" onclick="ShowResult()"
                        class="btn d-flex float-right mr-4">
                        <div class="spinner-border text-light" role="status">
                            <span class="sr-only">درحال جستجو ...</span>
                        </div>
                        جست‌وجو
                    </button>
                </div>
            </div>
        </form>

        <div dir="rtl" class="row w-100 p-0">
            <!--Original Tabs -->
            <ul id="original_tabs" class="nav nav-pills mt-5 mx-auto  pr-3 pr-sm-0  float-right  d-block" id="pills-tab"
                role="tablist">

                <li class="nav-item float-right" role="presentation">
                    <button id="multiple_terms_tab" class="nav-link active" data-bs-toggle="pill"
                        data-bs-target="#multiple_terms_pane" type="button" role="tab" aria-controls="multiple_terms_pane"
                        aria-selected="false">
                        تحلیل اسناد
                    </button>
                </li>

                <li class="nav-item float-right" role="presentation">
                    <button id="bar_chart_info_tab" class="nav-link" data-bs-toggle="pill"
                        data-bs-target="#bar_chart_info_pane" type="button" role="tab"
                        aria-controls="bar_chart_info_pane" aria-selected="false">داشبورد آماری</button>
                </li>

                <!-- Download Buttons -->
                <button type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="دانلود اسناد"
                    class="btn float-left p-0 px-1 mt-2" id="DownloadBtn" onclick="DownloadSearchResultFunction()"
                    type="button">
                    <i class="far fa-file-archive m-0" style="font-size: 25px;margin: 0px;"></i>

                </button>

                <button class="btn float-left p-0 px-1 mt-2" id="ExportExcel" data-bs-toggle="tooltip"
                    data-bs-placement="top" title="خروجی اکسل" onclick="ExportExcelSearchResultFunction()" type="button">
                    <i class="far fa-file-excel text-success m-0" style="font-size: 25px;margin: 0px;"></i>
                </button>

                <!-- Result Count -->
                <p id="SearchResultLable" class="text-left float-left text-secondary pl-2"></p>
            </ul>

            <!-- Original Panes -->
            <div id="original_pane" class="tab-content float-right px-1 bg-white" id="pills-tabContent">

                <!-- Multiple Terms Pane -->
                <div dir="rtl" class="tab-pane fade float-right w-100 show active" id="multiple_terms_pane" role="tabpanel"
                aria-labelledby="multiple_terms_tab">

                    <div dir="rtl" class="row mt-4 w-100 flex-row-reverse mx-auto">
                    <div dir="rtl" class="col-md-6 px-0 col-12 col-lg-6 pt-1">
                        <h6 class="table_header text-center  p-2  mb-0" id="second_words">

                        </h6>
                        <div class="mt-0 pr-2">
                            <table id="keywords2_table" style="min-height: 200px;" class="table table-striped table-bordered border-secondary keywords2_table">

                            </table>
                        </div>
                    </div>

                    <div dir="rtl" class="col-md-6 px-0 col-12 col-lg-6 pt-1">
                        <h6 class="table_header text-center  p-2  mb-0" id="first_words">

                        </h6>
                        <div class=" mt-0 pl-2">
                            <table id="keywords1_table" style="min-height: 200px;" class="table table-striped table-bordered border-secondary keywords1_table">

                            </table>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Bar chart Info Pane -->
                <div dir="rtl" class="tab-pane fade float-right w-100" id="bar_chart_info_pane" role="tabpanel"
                    aria-labelledby="bar_chart_info_tab">

                    <div class="row mt-4 w-100 flex-row-reverse mx-0 px-0">

                        <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                            <!-- Document Subject  segment -->
                            <h5 class="document_subject w-100 mt-4 text-center float-right pt-3 pb-3">
                                توزیع موضوعی اسناد
                            </h5>
                            <br>
                            <div style="margin-left: 1px !important;" id="subject_container" dir="ltr"
                                class="bg-white w-100 mx-auto py-4 px-1 border border-2 pb-2 vertical">
                                <span class='d-block text-center' style='color: dodgerblue'>
                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                    هیچ سندی یافت نشد
                                </span>
                            </div>
                        </div>

                        <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                            <!-- Document Level segment -->
                            <h5 class="document_level w-100 mt-4 text-center float-right pt-3 pb-3">
                                توزیع اسناد بر اساس سال تصویب
                            </h5>
                            <br>
                            <div id="year_container" dir="ltr"
                                class="bg-white w-100 mx-auto py-4 px-1 border border-2 pb-2 vertical">
                                <span class='d-block text-center' style='color: dodgerblue'>
                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                    هیچ سندی یافت نشد
                                </span>
                            </div>
                        </div>

                        <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                            <!-- Extracted References segment -->
                            <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                                توزیع اسناد بر اساس مرجع تصویب
                            </h5>
                            <br>
                            <div id="reference_container" dir='ltr'
                                class="bg-white w-100 mx-auto py-4 px-1 border border-2 pb-2 vertical">
                                <span class='d-block text-center' style='color: dodgerblue'>
                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                    هیچ سندی یافت نشد
                                </span>
                            </div>
                        </div>

                        <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                            <!-- Extracted References segment -->
                            <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                                متولیان اجرا
                            </h5>
                            <br>
                            <div id="motevalian_container" dir="ltr"
                                class="bg-white w-100 mx-auto py-4 px-1 border border-2 pb-2 vertical">
                                <span class='d-block text-center' style='color: dodgerblue'>
                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                    هیچ سندی یافت نشد
                                </span>
                            </div>
                        </div>

                        <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                            <!-- Extracted References segment -->
                            <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                                همکاران
                            </h5>
                            <br>
                            <div id="hamkaran_container" dir="ltr"
                                class="bg-white w-100 mx-auto py-4 px-1 border border-2 pb-2 vertical">
                                <span class='d-block text-center' style='color: dodgerblue'>
                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                    هیچ سندی یافت نشد
                                </span>
                            </div>
                        </div>

                        <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                            <!-- Extracted References segment -->
                            <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                                دارای صلاحیت اختیاری
                            </h5>
                            <br>
                            <div id="salahiat_container" dir="ltr"
                                class="bg-white w-100 mx-auto py-4 px-1 border border-2 pb-2 vertical">
                                <span class='d-block text-center' style='color: dodgerblue'>
                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                    هیچ سندی یافت نشد
                                </span>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

        </div>
    </div>

    <!-- Modal Container -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="DetailText" class="modal-body text-justify">
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>

    <!-- ChartModal Container -->
    <button type="button" id="ChartModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#ChartModal"></button>
    <div class="modal fade" id="ChartModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ChartModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="ChartModalText" class="modal-body text-justify">
                </div>


                <!-- Modal footer -->
                <div dir="rtl" class="modal-footer">
                    <button id="DownloadDocuments" class="btn btn-primary"><i class="fa fa-download"></i> دانلود
                        اسناد</button>

                    <button id="ExportExcel2" class="btn btn-primary"><i class="fa fa-download"></i> خروجی اکسل
                    </button>
                </div>

            </div>
        </div>
    </div>


    <!-- Scrollbar -->
    <button id="scroll_btn" class="p-0" title="بالای صفحه" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
        <!-- <i class="bi bi-chevron-up"></i> -->
        <!-- <i class="bi bi-chevron-double-up"></i> -->
        <!-- <i class="bi bi-arrow-up-circle"></i> -->
    </button>

    <script src="../../static/js/logincheck.js"></script>

    <script src="../../static/js/scroll_button_handler.js"></script>
    <script src="../../static/js/tooltip_handler.js"></script>
    <!-- Intro Js -->
    <script src="../../static/js/legal_literature_adaptation/legal_literature_adaptation_tour.js"></script>
    <script src="../../static/js/tour.js"></script>

    <!-- save log user -->
    <script>
        async function UserLog(form_data) {
            if (getCookie("username") !== "") {
                const user_name = getCookie("username")
                let page_url = window.location.pathname
                const user_ip = "127.0.0.0"
                page_url = page_url.slice(0, -1);
                if (page_url === "") {
                    page_url = "/0";
                }


                let link_request = 'http://' + location.host + "/UserLogSaved/" + user_name + page_url + "/" + user_ip + "/";

                $.ajax({
                    url: link_request,
                    data: form_data,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    async: true,


                }).done(function (res) {
                    console.log("done")

                }).fail(function (res) {
                    console.log("fail")
                });

            }
        }
    </script>



    <script>
        initSearchableSelects();

        let searchResultValue=[];

        container_id_list = ['keywords1_table', 'keywords2_table','first_words','second_words',
            'year_container','subject_container','reference_container',
        'motevalian_container','salahiat_container','hamkaran_container']

        function clearPrevResults(container_id_list) {

            for (container_id of container_id_list) {
                document.getElementById(container_id).innerHTML = "";
            }
        }

        async function CountryChanged(){
            clearPrevResults(container_id_list);
            //user log
            let form_data = new FormData()
            let detail_type = "نمایش پنل"
            form_data.append('detail_type', detail_type);
            UserLog(form_data)
        }
        
        async function ShowResult() {
            clearPrevResults(container_id_list);

    
            const country_id = document.getElementById("country").value;
            const text1 = document.getElementById("SearchBox1").value;
            const text2 = document.getElementById("SearchBox2").value;

            if(! (country_id.length>0 && text1.length>0 && text2.length>0)){
                alert("لطفا هردو کلیدواژه را وارد کنید!");
                return -1;
            }
            notyf.dismissAll();
            startBlockUI('multiple_terms_pane');
            startBlockUI('bar_chart_info_pane');
            
            await SpinnerModeFunction("Active");

            let request_link = 'http://' + location.host + "/SearchDocumentExact/" + country_id + "/0/0/0/0/0/0/0/" + text1 + "/"
            let response = await fetch(request_link).then(response => response.json());
            let documents_information_result1 = response["documents_information_result"];

            request_link = 'http://' + location.host + "/SearchDocumentExact/" + country_id + "/0/0/0/0/0/0/0/" + text2 + "/"
            response = await fetch(request_link).then(response => response.json());
            let documents_information_result2 = response["documents_information_result"];

            searchResultValue = documents_information_result1.concat(documents_information_result2);

            /******************************* Fill tables **********************************/

            await showKeywordsTable(documents_information_result1, 'keywords1_table');
            await showKeywordsTable(documents_information_result2, 'keywords2_table');
            document.getElementById('first_words').innerHTML = text1;
            document.getElementById('second_words').innerHTML = text2;
            
            stopBlockUI('multiple_terms_pane','تحلیل اسناد');

            /******************************* Draw chart **********************************/
            

            let subject_chart_data = createChartData(documents_information_result1, documents_information_result2, "subject");
            showChart(subject_chart_data, "subject_container", text1, text2, documents_information_result1, documents_information_result2, "موضوع");

            let year_chart_data = createChartData(documents_information_result1, documents_information_result2, "approval_year");
            year_chart_data = year_chart_data.sort(function(a, b) {
                if (!isNaN(a[0]) && !isNaN(b[0])){return  parseInt(a[0]) - parseInt(b[0]);}
                else if (isNaN(a[0])) { return -1; }
                else { return 1;}
            });
            showChart(year_chart_data, "year_container", text1, text2, documents_information_result1, documents_information_result2, "سال تصویب");

            let reference_chart_data = createChartData(documents_information_result1, documents_information_result2, "approval_reference");
            showChart(reference_chart_data, "reference_container", text1, text2, documents_information_result1, documents_information_result2, "مرجع تصویب");

            showActorsCharts(documents_information_result1, documents_information_result2, 'motevalian', text1, text2);
            showActorsCharts(documents_information_result1, documents_information_result2, 'hamkaran', text1, text2);
            showActorsCharts(documents_information_result1, documents_information_result2, 'salahiat', text1, text2);
            
            stopBlockUI('bar_chart_info_pane','داشبورد آماری');

            await SpinnerModeFunction("Disable");
        }

        async function showKeywordsTable(documents_information_result, container) {
            document.getElementById(container).innerHTML = "";
            let index = 1;
            let document_result = [];
            for (let doc of documents_information_result) {
                const id = doc["id"];
                const name = doc["name"];
                const keywords_count = doc["count"];
                const search_text = doc['searched_word'];
                const detail_function = "DetailFunction(" + id + ",'" + search_text + "')";
                const detail = '<button type="button" class="btn modal_btn" data-bs-toggle="modal" ' + ' onclick="' + detail_function + '" data-bs-target="#myModal">جزئیات</button>';

                const document_link = 'http://' + location.host + "/information/?id=" + id;
                const doc_name = '<a ' +
                                     'target="to_blank" href="' + document_link + '">' + name +
                                 "</a>";
                const row = { "id": index, "name": doc_name, "keywords_count": keywords_count, 'detail': detail }
                document_result.push(row);
                index += 1;
            }

            document_result.sort(function(first, second) {
                return second.keywords_count - first.keywords_count;
            });

            $('#'+container).empty();
            $('.'+container).footable({
                "paging": {
                    "enabled": true,
                    strings: {
                         first: '»',
                         prev:'›',
                         next: '‹',
                         last: '«'
                     }
                },
                "filtering": {
                    "enabled": false
                },
                "sorting": {
                    "enabled": true
                },
                "empty": "سندی یافت نشد.",
                "columns": [{
                    "name": "id",
                    "title": "ردیف",
                    "breakpoints": "xs sm",
                    "type": "number",
                    "style": {
                        "width": "5%"
                    }
                }, {
                    "name": "name",
                    "title": "نام سند",
                    "style": {
                        "width": "30%"
                    }
                }, {
                    "name": "keywords_count",
                    "title": "تعداد کلیدواژه",
                    "style": {
                        "width": "5%"
                    }
                }, {
                    "name": "detail",
                    "title": "جزئیات",
                    "style": {
                        "width": "10%"
                    }
                }
                ],
                "rows": document_result
            });
        }

        function createChartData(data1, data2, category){
            let chart_data = [];

            for(let d of data1){
                let index = -1
                chart_data.forEach(function (value, i) {
                    if (value[0] === d[category]){
                        index = i;
                    }
                });

                if(index >= 0) {
                    chart_data[index][1] += 1;
                } else {
                    chart_data.push([d[category], 1, 0])
                }
            }

            for(let d of data2){
                let index = -1
                chart_data.forEach(function (value, i) {
                    if (value[0] === d[category]){
                        index = i;
                    }
                });

                if(index >= 0) {
                    chart_data[index][2] += 1;
                } else {
                    chart_data.push([d[category], 0, 1])
                }
            }
            return chart_data;
        }

        function showActorsCharts(data1, data2, category, search_text1, search_text2) {
            let chart_data = [];

            for(let d of data1){
                let dict = d["actors"][category];
                for (let key in dict){
                    let index = -1;
                    chart_data.forEach(function (value, i) {
                        if (value[0] === key){
                            index = i;
                        }
                    });

                    if(index >= 0) {
                        chart_data[index][1] += 1;
                    } else {
                        chart_data.push([key, 1, 0])
                    }
                }
            }

            for(let d of data2){
                let dict = d["actors"][category];
                for (let key in dict){
                    let index = -1;
                    chart_data.forEach(function (value, i) {
                        if (value[0] === key){
                            index = i;
                        }
                    });

                    if(index >= 0) {
                        chart_data[index][2] += 1;
                    } else {
                        chart_data.push([key, 0, 1])
                    }
                }
            }
            showChart(chart_data, category+'_container', search_text1, search_text2, data1, data2, "کنشگر");
        }

        function showChart(chart_data, chart_container, search_text1, search_text2, documents_information_result1, documents_information_result2, xAxisTitle) {
            document.getElementById(chart_container).innerHTML = ""
            if(chart_data.length < 1){
                SpinnerModeFunction("Disable");
                document.getElementById(chart_container).innerHTML = "<span class='d-block text-center' style='color: dodgerblue'>\n" +
                "                                    <i class=\"fa fa-ban\" aria-hidden=\"true\"></i>\n" +
                "                                    هیچ سندی یافت نشد\n" +
                "                                </span>"
                return -1;
            }

            chart_data.sort(function(x,y){ return x[0] === 'نامشخص' ? -1 : y[0] === 'نامشخص' ? 1 : 0; });


            // create a data set
            let data = anychart.data.set(chart_data);

            // map the data
            let document_series_data = data.mapAs({ x: 0, value: 1 });
            let draft_series_data = data.mapAs({ x: 0, value: 2 });


            // create a chart
            let chart = anychart.column();

            chart
                .animation(true)
                .padding([80, 60, 10, 0])

            chart.background().fill('#ffffff');


            // x axix labels font setting
            let xAxisLabels = chart.xAxis().labels();
            xAxisLabels.fontFamily("vazir");
            xAxisLabels.rotation(315);

            let yAxisLabels = chart.yAxis().labels();
            yAxisLabels.fontFamily("vazir");

            // Not allow labels overlapping
            let xAxis = chart.xAxis();
            xAxis.overlapMode("noOverlap");
            xAxis.title(xAxisTitle);
            xAxis.title().fontFamily('vazir');
xAxis.title().fontWeight("bold");
            xAxis.title().height(40);

            let yAxis = chart.yAxis();
            yAxis.title("تعداد سند");
            yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
            yAxis.title().height(40);


            chart.yScale().minimum(0);
            chart.yScale().ticks().allowFractional(false);
            // tooltip content font setting
            let tooltip = chart.tooltip();
            tooltip.fontFamily("vazir");

            // tooltip title font setting
            let title = chart.tooltip().title();
            title.fontFamily("vazir");


            // set the container id
            chart.container(chart_container);


            // create the first series, set the data and name
            let document_series = chart.column(document_series_data);

            // configure the visual settings of the first series
            document_series.normal().fill("#28a745");
            document_series.normal().stroke("#28a745", 0);
            document_series.name(search_text1);

            // create the second series, set the data and name
            let draft_series = chart.column(draft_series_data);
            draft_series.normal().stroke("#28a745", 0);

            // configure the visual settings of the second series
            draft_series.normal().fill("#ffc107");

            draft_series.name(search_text2);


            // enable the legend
            chart.legend(true);

            let legend = chart.legend();
            legend.fontFamily('vazir')

            // set position mode
            legend.positionMode("inside");
            // set position and alignement
            legend.position("top");
            legend.align("center");
            legend.itemsLayout("horizontalExpandable");
            // initiate drawing the chart
            chart.draw();
            chart.listen("mouseOver", function(e){
              document.body.style.cursor = "pointer";
            });
            chart.listen("mouseOut", function(e){
              document.body.style.cursor = "auto";
            });

            chart.listen('Click', async function (event) {
                const click_tag = event.domTarget.tag;
                const index = click_tag["index"];
                let documents_information_result = documents_information_result1;
                if (click_tag['X']['Pq'] > 0) {
                    documents_information_result = documents_information_result2;
                }

                const text = data.row(index)[0];
                let filtered_result = []
                let header = ""
                let save_file_name = "انطباق حقوقی";

                if (chart_container.includes("subject_container")) {
                    filtered_result = documents_information_result.filter(function (row) {
                        if (row["subject"] === text)
                            return row
                    });
                    header = "موضوع: " + text
                    save_file_name += " (مجموعه سند {1} و موضوع {2})".replace("1", filtered_result[0]["country"]).replace("2", text)
                } else if (chart_container.includes("reference_container")) {
                    filtered_result = documents_information_result.filter(function (row) {
                        if (row["approval_reference"] === text)
                            return row;
                    });
                    header = "مرجع تصویب: " + text
                    save_file_name += " (مجموعه سند {1} و مرجع تصویب {2})".replace("1", filtered_result[0]["country"]).replace("2", text)
                } else if (chart_container.includes("year_container")) {
                    filtered_result = documents_information_result.filter(function (row) {
                        if (row["approval_year"] === text.toString())
                            return row;
                    });
                    header = "سال تصویب: " + text
                    save_file_name += " (مجموعه سند {1} و سال تصویب {2})".replace("1", filtered_result[0]["country"]).replace("2", text)
                } else if (chart_container.includes("motevalian_container")) {
                    filtered_result = documents_information_result.filter(function (row) {
                        let dict = row["actors"]["motevalian"];
                        for (let key in dict){
                            if (key === text) {
                                return row;
                            }
                        }
                    });
                    header = "متولیان اجرا: " + text
                    save_file_name += " (مجموعه سند {1} و متولیان اجرا {2})".replace("1", filtered_result[0]["country"]).replace("2", text)
                } else if (chart_container.includes("hamkaran_container")) {
                    filtered_result = documents_information_result.filter(function (row) {
                        let dict = row["actors"]["hamkaran"];
                        for (let key in dict){
                            if (key === text) {
                                return row;
                            }
                        }
                    });
                    header = "همکاران: " + text
                    save_file_name += " (مجموعه سند {1} و همکاران {2})".replace("1", filtered_result[0]["country"]).replace("2", text)
                } else if (chart_container.includes("salahiat_container")) {
                    filtered_result = documents_information_result.filter(function (row) {
                        let dict = row["actors"]["salahiat"];
                        for (let key in dict){
                            if (key === text) {
                                return row;
                            }
                        }
                    });
                    header = "دارای صلاحیت اختیاری: " + text
                    save_file_name += " (مجموعه سند {1} و دارای صلاحیت اختیاری {2})".replace("1", filtered_result[0]["country"]).replace("2", text)
                }

                document.getElementById("ChartModalHeader").innerText = header
                let filtered_result_tag = ""
                let list_of_docId = ""
                for (const doc of filtered_result) {
                    const link = 'http://' + location.host + "/information/?id=" + doc["id"]
                    let tag = "<li class='mt-3' id=" + doc["id"] + "><a href='" + link + "'>" + doc["name"] + "</a></li>"
                    filtered_result_tag += tag

                    list_of_docId += doc["id"] + "_"
                }
                filtered_result_tag = "<ol start='1'>" + filtered_result_tag + "</ol>"
                document.getElementById("ChartModalText").innerHTML = filtered_result_tag


                 /* download file creation */
                document.getElementById("DownloadDocuments").onclick = function () {
                    downloadFiles(filtered_result, save_file_name);
                };

                /* export into excel files */
                document.getElementById("ExportExcel2").onclick = function ExportExcelFunction() {

                    var csv = "";

                    sep = ","
                    let Csv = "نام سند" + sep + "سطح سند" + sep +
                        "موضوع سند" + sep + "نوع سند" + sep + "مرجع تصویب" + sep + "تاریخ تصویب" + "\n"
                    for (const document of filtered_result) {
                        Csv += document["name"] + sep + document["level"] + sep + document["subject"] + sep +
                            document["type"] + sep + document["approval_reference"] + sep + document["approval_date"] + "\n"

                    }

                    let csvContent = "data:text/csv;charset=utf-8,%EF%BB%BF" + encodeURI(Csv);
                    var link = document.createElement("a");
                    link.setAttribute("href", csvContent);
                    link.setAttribute("download", save_file_name + ".csv");
                    document.body.appendChild(link);
                    link.click()
                };

                $("#ChartModalBtn").click();
        })
        }

        async function SpinnerModeFunction(mode) {
            if (mode === "Active") {
                $(".spinner-border").addClass("active");
            } else if (mode === "Disable") {
                $(".spinner-border").removeClass("active");
            }
        }

        async function DetailFunction(document_id, text) {
            let request_link = 'http://' + location.host + "/GetSearchDetailsExact/" + document_id + "/" + text + "/" + 0 + "/";
            let response = await fetch(request_link).then(response => response.json());

            /*  Show detail Result */
            let document_paragraphs_result = response["document_paragraphs_result"];
            let preprocess_text = response["preprocess_text"][0];
            let document_name = response["document_name"][0];

            await showDetailsDataExact(document_id, document_name, document_paragraphs_result, preprocess_text);
        }

        async function showDetailsDataExact(document_id, document_name, paragraphs_list, text) {
            /* Title Text */
            const link = 'http://' + location.host + "/information/?id=" + document_id;
            let title_tag = "<a href='" + link + "'>" + document_name + "</a>";
            document.getElementById("ModalHeader").innerHTML = title_tag;

            /* Body Text */
            const words = text.split(" ");
            document.getElementById("DetailText").innerHTML = "";
            for (let paragraph of paragraphs_list) {
                let tag = "<span class='text-primary bold'>" + text + "</span> "

                let index = paragraph.indexOf(text);
                let par_len = paragraph.length;
                while (index !== -1) {
                    paragraph = paragraph.substring(0, index) +
                        "<span class='text-primary bold'>" +
                        paragraph.substring(index, index + text.length) +
                        "</span>" +
                        paragraph.substring(index + text.length);

                    let temp = paragraph.length - par_len
                    par_len = paragraph.length
                    index = paragraph.indexOf(text, index + temp);
                }

                tag = "<li class='mb-3'>" + paragraph + "</li>";
                document.getElementById("DetailText").innerHTML += tag;
            }
            document.getElementById("DetailText").innerHTML = "<ul>" + document.getElementById("DetailText").innerHTML + "</ul>"
        }


    </script>

    <!-- Export results -->
    <script>
        async function downloadFiles(file_name_list, save_file_name) {
            startFullPageBlockUI()
            const country_id = file_name_list[0]["country_id"]

            let zip = new JSZip()

            const request_link = 'http://' + location.host + "/GetCountryById/" + country_id + "/";
            let response = await fetch(request_link).then(response => response.json());
            response = response["country_information"][0]
            const country_folder = response["folder"];
            const country_name = response["name"];

            save_file_name += " مجموعه سند {" + country_name + "}"


            let extension = ".txt"
            if (country_name.includes("فاوا")) {
                extension = '.docx';
            }

            for (const document of file_name_list) {
                const document_name = document["name"] + extension
                const path = 'http://' + location.host + '/media/data/' + country_folder + '\\' + document_name;

                await fetch(path)
                    .then(res => res.arrayBuffer())
                    .then(value => {
                        zip.file(document_name, value);
                    })
            }
            zip.generateAsync({
                type: "blob"
            })
                .then(function (content) {
                    // see FileSaver.js
                    saveAs(content, save_file_name + ".zip");
                });
            stopFullPageBlockUI( 'دانلود اسناد');
        }

        async function DownloadSearchResultFunction() {
            const save_file_name = " انطباق حقوقی در";
            await downloadFiles(searchResultValue, save_file_name);
        }

        async function ExportExcelSearchResultFunction() {
        var csv = "";

        sep = ","


        let Csv = "نام سند" + sep + "کلیدواژه جستجوشده" + sep +
            "موضوع سند" + sep + "مرجع تصویب" + sep + "تاریخ تصویب" + sep + "تعداد کلیدواژه" + "\n"
        for (const document of searchResultValue) {
            Csv += document["name"] + sep + document["searched_word"] + sep + document["subject"] + sep +
                + document["approval_reference"] + sep + document["approval_date"] + sep + document["count"] + "\n"

        }

        let save_file_name = " انطباق حقوقی در"
        save_file_name += " مجموعه سند {" + $('#country option:selected').text() + "}"

        let csvContent = "data:text/csv;charset=utf-8,%EF%BB%BF" + encodeURI(Csv);
        var link = document.createElement("a");
        link.setAttribute("href", csvContent);
        link.setAttribute("download", save_file_name + ".csv");
        document.body.appendChild(link);
        link.click()
    }

    /* Search after press Enter */
    $("#info_form").submit(function() {return false;});
    $("#SearchBox2").keyup(function (event) {
        if (event.keyCode === 13) {
            ShowResult()
        }
    });

    </script>
    <script src="../../static/js/zipDownload/jszip.min.js"></script>
    <script src="../../static/js/zipDownload/FileSaver.min.js"></script>

</body>
<!-- <script src="../../static/js/UserLogSave.js"></script>-->
<script src="../../static/js/signout_function.js"></script>



<!-- Blocking UI -->
<script src="../../static/js/blockUI.js"></script>
<script src="../../static/js/blockUI_handler.js"></script>
<link rel="stylesheet" href="../../static/styles/loader.css">

</html>